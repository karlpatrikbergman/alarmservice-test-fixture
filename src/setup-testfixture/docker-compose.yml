version: "2"
services:
  alarmservice:
    image: se.infinera.metro/alarm-service:1.0-SNAPSHOT
    restart: unless-stopped
    container_name: alarmservice
    environment:
      SPRING_PROFILES_ACTIVE: docker-compose
    ports:
      - 8080:8080
    depends_on:
    - alarmservice_db
    links:
    - alarmservice_db
    entrypoint: ./wait-for-it.sh
    command: alarmservice_db:3306 --timeout=20 -- ./entrypoint.sh
  alarmservice_db:
    image: mariadb:latest
    container_name: alarmservice_db
    ports:
      - 3307:3306 #<port-on-host>:<port-on-container>
    environment:
      MYSQL_USER: admin
      MYSQL_PASSWORD: admin
      MYSQL_DATABASE: alarmservice
      MYSQL_ROOT_PASSWORD: root
  node1:
    image: artifactory.transmode.se/tm3k/trunk-hostenv
    container_name: node1
    ports:
      - 8001:80 #<port-on-host>:<port-on-container>
  node2:
    image: artifactory.transmode.se/tm3k/trunk-hostenv
    container_name: node2
    ports:
      - 8002:80 #<port-on-host>:<port-on-container>
  nodes_setup:
    build: nodes_setup
    container_name: nodes_setup
    depends_on:
      - node1
      - node2
    links:
      - node1
      - node2